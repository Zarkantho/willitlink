# This file represents the required schema for both the human generated and the processed project
# files.
#
#
#
# Essentially, this file contains nested categorizations of files along with descriptions and names
# at each level.  There are currently three nested categories:
#
# System - Top level category.  This defines the highest level architecure of the project.  For a
# database, this will be things like "queries", "storage", "network", and "utilities".
#
# Module - Nested within System.  This defines more granular functional units in a project.  For
# example, within the "queries" System, you may have the "aggregation", "text search queries", "geo
# queries", and "queries core".
#
# Group - Nested within Module.  This defines logical groupings of files within a functional unit.
# for example, in the "text search queries" module, you may have "stemming" (normalizing words to
# their canonical form), and "stopword handling" (removing things like "and" and "the") as logical
# groups within the "text search queries" module.
#
# Each level should have a name and a description.  A project file with this format can be read into
# a script that attaches any autogenerated data that may be useful for understanding, such as
# dependency data or header include information.
#
#
#
# This same schema is also used to validate the processed document.  In that case, there will be an
# extra "group_generated_data" field.  See comments below.

### Top level array of all Systems in this project ###
type: array
items:

    ### System Information Object ###
    type: object
    required:
    - system_name
    - system_title
    - system_description
    - system_modules
    additionalProperties: false
    properties:
        # Name of this system with underscores
        system_name:
            type: string
            pattern: "^[_a-z0-9]*$"

        # Name of this system with spaces and capitals
        system_title:
            type: string
            pattern: "^[ a-zA-Z0-9]*$"

        # Description of this system
        system_description:
            type: string

        ### Modules in this system ###
        system_modules:
            type: array
            items:

                ### Module Information Object ###
                type: object
                required:
                - module_name
                - module_title
                - module_description
                - module_groups
                additionalProperties: false
                properties:
                    # Name of this module with underscores
                    module_name:
                        type: string
                        pattern: "^[_a-z0-9]*$"

                    # Name of this module with spaces and capitals
                    module_title:
                        type: string
                        pattern: "^[ a-zA-Z0-9]*$"

                    # Description of this module
                    module_description:
                        type: string

                    ### Logical Groups of files within this Module ###
                    module_groups:
                        type: array
                        items:

                            ### Group Information Object ###
                            type: object
                            required:
                            - group_title
                            - group_description
                            - group_files
                            additionalProperties: false
                            properties:
                                # Name of this group with capitals and spaces
                                group_title:
                                    type: string

                                # Description of this group
                                group_description:
                                    type: string

                                # Files in this group
                                group_files:
                                    type: array
                                    items:

                                        # File name of file in this group
                                        type: string

                                # Automatically generated data for this group.  Note that this is
                                # NOT a required field, since this schema can be used to validate
                                # both the human generated module file without this field and the
                                # processed module file with this field.
                                group_generated_data:

                                    # Since all the higher level constructs, like System, Module and
                                    # Group are logical groupings made by the user and not actually
                                    # real objects in the build, the only underlying entity that has
                                    # autogenerated data associated with it is a file
                                    type: array
                                    items:

                                        # Using a reference to the file_data schema below to make
                                        # this more readable
                                        $ref: "#/definitions/file_data"


### Auto Generated File Data Object ###
definitions:
    file_data:
        type: object
        required:
        - file_name
        - file_executables
        - file_interface
        - file_dependencies
        additionalProperties: false
        properties:

            # Name of this file
            file_name:
                type: string

            # Executables this file gets built into
            file_executables:
                type: array

                items:
                    type: string

            # Symbols used in this file
            file_interface:
                type: array

                items:
                    type: object
                    required:
                    - symbol_name
                    - symbol_uses
                    additionalProperties: false
                    properties:

                        # Name of this symbol
                        symbol_name:
                            type: string

                        # Files where this symbol is used
                        symbol_uses:
                            type: array

                            items:
                                type: string

            # Symbols required by this file
            file_dependencies:
                type: array

                items:
                    type: object
                    required:
                    - symbol_name
                    - symbol_sources
                    additionalProperties: false
                    properties:

                        # Name of this symbol
                        symbol_name:
                            type: string

                        # Files where this symbol is defined
                        symbol_sources:
                            type: array

                            items:
                                type: string
